# Story 4.4: Behavior Settings Controls

## Status
Ready for Review

## Story

**As a** user,
**I want** to configure application behavior settings,
**so that** I can control features like deletion confirmation

## Acceptance Criteria

1. **YOLO Mode**: Toggle for `settings.yolo` (skip deletion confirmations)
2. **Auto-save Interval**: Dropdown for panel state save frequency (manual, 30s, 1min, 5min)
3. **Restore Session**: Toggle to enable/disable panel state restoration on load
4. **Confirmation Dialogs**: Toggle for various confirmation prompts
5. All behavior settings persist to localStorage

## Tasks / Subtasks

- [ ] **Task 1: Add YOLO Mode toggle** (AC: 1, 5)
  - [ ] Add toggle switch to Behavior section in settings modal
  - [ ] Label: "YOLO Mode (Skip deletion confirmations)"
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="yolo-toggle">
        <input type="checkbox" id="yolo-toggle">
        YOLO Mode (Skip deletion confirmations)
      </label>
      <p class="setting-description">
        Disable confirmation dialogs when deleting panels
      </p>
    </div>
    ```
  - [ ] Bind to `settings.yolo` value
  - [ ] On change, update settings and save to localStorage

- [ ] **Task 2: Add Auto-save Interval dropdown** (AC: 2, 5)
  - [ ] Add dropdown select to Behavior section
  - [ ] Label: "Auto-save Panel State"
  - [ ] Options: Manual, Every 30 seconds, Every 1 minute, Every 5 minutes
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="autosave-interval-select">Auto-save Panel State</label>
      <select id="autosave-interval-select">
        <option value="manual">Manual (on panel change)</option>
        <option value="30s">Every 30 seconds</option>
        <option value="1min">Every 1 minute</option>
        <option value="5min">Every 5 minutes</option>
      </select>
      <p class="setting-description">
        How frequently to save panel state to localStorage
      </p>
    </div>
    ```
  - [ ] Bind to `settings.behavior.autoSaveInterval`
  - [ ] On change, update settings and restart auto-save timer

- [ ] **Task 3: Add Restore Session toggle** (AC: 3, 5)
  - [ ] Add toggle switch to Behavior section
  - [ ] Label: "Restore Session on Load"
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="restore-session-toggle">
        <input type="checkbox" id="restore-session-toggle">
        Restore Session on Load
      </label>
      <p class="setting-description">
        Automatically restore panels and code from previous session
      </p>
    </div>
    ```
  - [ ] Bind to `settings.behavior.restoreSession`
  - [ ] On change, update settings (takes effect on next page load)

- [ ] **Task 4: Add Confirmation Dialogs toggle** (AC: 4, 5)
  - [ ] Add toggle switch to Behavior section
  - [ ] Label: "Show Confirmation Dialogs"
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="confirmation-dialogs-toggle">
        <input type="checkbox" id="confirmation-dialogs-toggle">
        Show Confirmation Dialogs
      </label>
      <p class="setting-description">
        Show confirmation prompts for destructive actions (overrides YOLO mode)
      </p>
    </div>
    ```
  - [ ] Bind to `settings.behavior.confirmationDialogs`
  - [ ] If disabled, all confirmation dialogs are skipped

- [ ] **Task 5: Wire behavior settings to application logic** (AC: 1, 4)
  - [ ] Import settings in panel deletion function (Story 1.2):
    ```javascript
    function deletePanel(panelId) {
      const settings = getSettings();
      if (!settings.yolo && settings.behavior.confirmationDialogs) {
        const confirmed = confirm('Delete this panel?');
        if (!confirmed) return;
      }
      // Proceed with deletion
    }
    ```
  - [ ] Check YOLO mode before showing any confirmation dialog
  - [ ] Apply Confirmation Dialogs setting to all prompts

- [ ] **Task 6: Implement auto-save interval logic** (AC: 2)
  - [ ] Create `startAutoSaveTimer()` function in panelManager.js:
    ```javascript
    let autoSaveTimer;
    function startAutoSaveTimer(interval) {
      clearInterval(autoSaveTimer);
      if (interval === 'manual') return;

      const ms = {
        '30s': 30000,
        '1min': 60000,
        '5min': 300000
      }[interval];

      autoSaveTimer = setInterval(savePanelState, ms);
    }
    ```
  - [ ] Call `startAutoSaveTimer()` on settings change
  - [ ] Call `startAutoSaveTimer()` on app initialization

- [ ] **Task 7: Load behavior settings into form** (AC: 5)
  - [ ] When opening settings modal, load current values:
    ```javascript
    const settings = getSettings();
    document.getElementById('yolo-toggle').checked = settings.yolo;
    document.getElementById('autosave-interval-select').value = settings.behavior.autoSaveInterval;
    document.getElementById('restore-session-toggle').checked = settings.behavior.restoreSession;
    document.getElementById('confirmation-dialogs-toggle').checked = settings.behavior.confirmationDialogs;
    ```

- [ ] **Task 8: Save behavior settings on form change** (AC: 5)
  - [ ] Attach change event listeners to all behavior controls
  - [ ] On change, collect new values and call `updateSettings()`:
    ```javascript
    document.getElementById('yolo-toggle').addEventListener('change', (e) => {
      updateSettings('yolo', e.target.checked);
    });

    document.getElementById('autosave-interval-select').addEventListener('change', (e) => {
      updateSettings('behavior.autoSaveInterval', e.target.value);
      startAutoSaveTimer(e.target.value); // Restart timer
    });
    ```
  - [ ] Ensure settings persist to localStorage immediately

- [ ] **Task 9: Style behavior settings section** (AC: 1-4)
  - [ ] Add CSS for toggle switches (styled checkboxes)
  - [ ] Style dropdowns to match application theme
  - [ ] Use consistent spacing and alignment
  - [ ] Add setting descriptions (small text below labels)

## Dev Notes

### Behavior Settings Section HTML
[Source: AC: 1-4, epic-4-settings-system.md]

```html
<section class="settings-section" id="behavior-settings">
  <h3>Behavior</h3>

  <!-- YOLO Mode Toggle (AC: 1) -->
  <div class="setting-item">
    <label class="toggle-label">
      <input type="checkbox" id="yolo-toggle" class="toggle-input">
      <span class="toggle-slider"></span>
      <span class="toggle-text">YOLO Mode (Skip deletion confirmations)</span>
    </label>
    <p class="setting-description">
      Disable confirmation dialogs when deleting panels. For users who like to live dangerously.
    </p>
  </div>

  <!-- Auto-save Interval (AC: 2) -->
  <div class="setting-item">
    <label for="autosave-interval-select">Auto-save Panel State</label>
    <select id="autosave-interval-select" class="setting-select">
      <option value="manual">Manual (on panel change)</option>
      <option value="30s">Every 30 seconds</option>
      <option value="1min">Every 1 minute</option>
      <option value="5min">Every 5 minutes</option>
    </select>
    <p class="setting-description">
      How frequently to save panel state to localStorage
    </p>
  </div>

  <!-- Restore Session Toggle (AC: 3) -->
  <div class="setting-item">
    <label class="toggle-label">
      <input type="checkbox" id="restore-session-toggle" class="toggle-input">
      <span class="toggle-slider"></span>
      <span class="toggle-text">Restore Session on Load</span>
    </label>
    <p class="setting-description">
      Automatically restore panels and code from previous session when opening the app
    </p>
  </div>

  <!-- Confirmation Dialogs Toggle (AC: 4) -->
  <div class="setting-item">
    <label class="toggle-label">
      <input type="checkbox" id="confirmation-dialogs-toggle" class="toggle-input">
      <span class="toggle-slider"></span>
      <span class="toggle-text">Show Confirmation Dialogs</span>
    </label>
    <p class="setting-description">
      Show confirmation prompts for destructive actions (overrides YOLO mode if disabled)
    </p>
  </div>
</section>
```

### Toggle Switch CSS
[Source: Modern toggle switch pattern]

```css
.toggle-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  gap: 10px;
}

.toggle-input {
  display: none; /* Hide default checkbox */
}

.toggle-slider {
  position: relative;
  width: 50px;
  height: 24px;
  background: #333;
  border: 1px solid #00ff00;
  border-radius: 12px;
  transition: background 0.2s;
}

.toggle-slider::before {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  left: 3px;
  top: 2px;
  background: #00ff00;
  border-radius: 50%;
  transition: transform 0.2s;
}

.toggle-input:checked + .toggle-slider {
  background: rgba(0, 255, 0, 0.2);
}

.toggle-input:checked + .toggle-slider::before {
  transform: translateX(26px);
}

.toggle-text {
  color: #00ff00;
  font-size: 14px;
}

.setting-description {
  color: #888;
  font-size: 12px;
  margin: 5px 0 0 60px; /* Indent below toggle */
}
```

### Dropdown Select Styling
[Source: AC: 2, application theme]

```css
.setting-select {
  width: 100%;
  padding: 8px;
  background: #1a1a1a;
  border: 1px solid #00ff00;
  color: #00ff00;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
}

.setting-select:focus {
  outline: none;
  border-color: #00ff00;
  box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
}

.setting-select option {
  background: #1a1a1a;
  color: #00ff00;
}
```

### YOLO Mode Integration
[Source: AC: 1, Story 1.2 delete panel functionality]

Apply YOLO mode to panel deletion:
```javascript
// src/managers/panelManager.js
export function deletePanel(panelId) {
  const settings = getSettings();

  // Check YOLO mode and confirmation dialogs setting
  if (!settings.yolo && settings.behavior.confirmationDialogs) {
    const confirmed = confirm('Are you sure you want to delete this panel?');
    if (!confirmed) return;
  }

  // Proceed with deletion
  const panel = document.getElementById(panelId);
  panel.remove();
  delete panels[panelId];
  savePanelState();
}
```

### Auto-Save Interval Implementation
[Source: AC: 2]

```javascript
// src/managers/panelManager.js
let autoSaveTimer;

export function startAutoSaveTimer(interval) {
  // Clear existing timer
  clearInterval(autoSaveTimer);

  // If manual, don't start timer (save only on changes)
  if (interval === 'manual') {
    console.log('Auto-save: Manual mode (save on panel change)');
    return;
  }

  // Map interval to milliseconds
  const intervals = {
    '30s': 30000,
    '1min': 60000,
    '5min': 300000
  };

  const ms = intervals[interval];
  if (!ms) {
    console.error('Invalid auto-save interval:', interval);
    return;
  }

  // Start timer
  autoSaveTimer = setInterval(() => {
    savePanelState();
    console.log('Auto-save: Panel state saved');
  }, ms);

  console.log(`Auto-save: Enabled (every ${interval})`);
}

// Call on app init
const settings = loadSettings();
startAutoSaveTimer(settings.behavior.autoSaveInterval);
```

### Restore Session Integration
[Source: AC: 3, Story 4.2]

Check setting before restoring panels:
```javascript
// src/main.js
async function initializeApp() {
  const settings = loadSettings();

  await initializeStrudel();

  // Restore panels only if setting enabled
  if (settings.behavior.restoreSession) {
    const savedPanels = loadPanelState();
    if (savedPanels) {
      restorePanels(savedPanels);
    } else {
      createDefaultPanels();
    }
  } else {
    console.log('Session restore disabled, using default panels');
    createDefaultPanels();
  }
}
```

### Confirmation Dialogs Integration
[Source: AC: 4]

Create reusable confirmation function:
```javascript
// src/utils/dialogs.js
export function confirmAction(message) {
  const settings = getSettings();

  // If confirmation dialogs disabled, auto-confirm
  if (!settings.behavior.confirmationDialogs) {
    return true;
  }

  // If YOLO mode enabled, skip confirmation
  if (settings.yolo) {
    return true;
  }

  // Show confirmation dialog
  return confirm(message);
}

// Usage:
if (confirmAction('Delete this panel?')) {
  deletePanel(panelId);
}
```

### Settings Persistence
[Source: AC: 5, Story 4.1]

Save behavior settings immediately on change:
```javascript
// Wire all behavior controls
document.getElementById('yolo-toggle').addEventListener('change', (e) => {
  const settings = getSettings();
  settings.yolo = e.target.checked;
  saveSettings(settings);
  console.log('YOLO mode:', settings.yolo ? 'enabled' : 'disabled');
});

document.getElementById('autosave-interval-select').addEventListener('change', (e) => {
  const settings = getSettings();
  settings.behavior.autoSaveInterval = e.target.value;
  saveSettings(settings);
  startAutoSaveTimer(e.target.value); // Restart timer
});

document.getElementById('restore-session-toggle').addEventListener('change', (e) => {
  const settings = getSettings();
  settings.behavior.restoreSession = e.target.checked;
  saveSettings(settings);
  console.log('Session restore:', settings.behavior.restoreSession ? 'enabled' : 'disabled');
});

document.getElementById('confirmation-dialogs-toggle').addEventListener('change', (e) => {
  const settings = getSettings();
  settings.behavior.confirmationDialogs = e.target.checked;
  saveSettings(settings);
});
```

### Default Behavior Settings
[Source: Story 4.1, DEFAULT_SETTINGS schema]

```javascript
const DEFAULT_SETTINGS = {
  version: 1,
  yolo: false,                // AC: 1 - Confirmations enabled by default
  colorScheme: 'dark',
  behavior: {
    autoSaveInterval: 'manual',         // AC: 2 - Manual save by default
    restoreSession: true,               // AC: 3 - Restore enabled by default
    confirmationDialogs: true           // AC: 4 - Confirmations enabled by default
  },
  snippetLocation: '',
  remoteWSLayout: 'side-panel',
  skinPack: ''
};
```

### Testing

Manual testing checklist:

- [ ] YOLO Mode toggle visible in Behavior section
- [ ] Toggling YOLO mode saves to localStorage immediately
- [ ] YOLO mode enabled: Panel deletion skips confirmation
- [ ] YOLO mode disabled: Panel deletion shows confirmation
- [ ] Auto-save dropdown visible with 4 options
- [ ] Changing auto-save interval restarts timer
- [ ] Manual mode: Panel state saves only on panel change
- [ ] 30s/1min/5min modes: Panel state saves at correct intervals
- [ ] Restore Session toggle visible and functional
- [ ] Restore Session enabled: Panels restored on page load
- [ ] Restore Session disabled: Default panels created on page load
- [ ] Confirmation Dialogs toggle visible and functional
- [ ] Confirmation Dialogs disabled: All confirmations skipped
- [ ] Settings persist after page reload
- [ ] Toggle switches styled correctly (slider animation)
- [ ] Dropdown styled to match application theme

## Change Log

| Date       | Version | Description          | Author |
|------------|---------|----------------------|--------|
| 2025-11-16 | 1.0     | Initial story draft  | Claude |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review of the completed story implementation_
