# Story 2.2: Resizable Panels

## Status
Ready for Review

## Story

**As a** live coder,
**I want** to resize panels by dragging their edges,
**so that** I can allocate more space to complex patterns and less to simple ones

## Acceptance Criteria

1. Panel edges have visible resize handles (borders are draggable)
2. Dragging edge/corner resizes panel width and/or height
3. Panel maintains minimum size (e.g., 300x200px) to prevent unusability
4. Textarea inside panel grows/shrinks with panel size
5. Slider controls remain visible and functional during resize
6. Panel size is saved in panel state

## Tasks / Subtasks

- [x] **Task 1: Evaluate and integrate resize library** (AC: 1, 2)
  - [x] Research options: interact.js, re-resizable, plain-resizable
  - [x] Recommendation: interact.js (handles both drag and resize)
  - [x] Install via npm: `npm install interactjs`
  - [x] Import in `src/main.js` or create `src/ui/dragResize.js` wrapper module

- [x] **Task 2: Update panel CSS for absolute positioning** (AC: 1, 2)
  - [x] Change `.card` class from grid/flexbox to `position: absolute`
  - [x] Set default position and size for panels: `left: 0, top: 0, width: 400px, height: 300px`
  - [x] Add resize handles via CSS: `.card::after` for corner handle or library-provided handles
  - [x] Ensure panels can overlap (z-index managed by Story 2.4)

- [x] **Task 3: Initialize interact.js resize functionality** (AC: 2, 3)
  - [x] Create `initializeResizable(panelElement)` function in `src/ui/dragResize.js`
  - [x] Configure interact.js with all edges and minimum size constraints
  - [x] Call `initializeDragAndResize()` for each panel after rendering

- [x] **Task 4: Implement resize event handler** (AC: 2, 6)
  - [x] Attach `resizemove` event listener to panels
  - [x] Update panel element size: `target.style.width = event.rect.width + 'px'`
  - [x] Update panel state: `updatePanel(panelId, { size, position })`
  - [x] Ensure position is maintained (interact.js may adjust position during resize)

- [x] **Task 5: Update panel state schema to store size** (AC: 6)
  - [x] Panel state includes `size: { w, h }` property (already exists from Story 1.1)
  - [x] Set default size in `createPanel()`: `{ w: 400, h: 300 }`
  - [x] Use existing `updatePanel()` function to save size changes
  - [x] Save size to localStorage if Epic 4 (Settings System) is implemented

- [x] **Task 6: Make textarea responsive to panel resize** (AC: 4)
  - [x] Use CSS flexbox inside `.card` to make textarea fill available space
  - [x] Structure: `.card` → `.card-header` (fixed height) + `.code-input` (flex-grow)
  - [x] Test textarea scrollbar appears correctly when content exceeds height
  - [x] Ensure textarea maintains padding and readability at minimum size

- [x] **Task 7: Ensure sliders remain visible during resize** (AC: 5)
  - [x] Position `.slider-container` below textarea with fixed or auto height
  - [x] Use CSS overflow: auto on slider container if many sliders present
  - [x] Test slider functionality (drag handles, value updates) works at minimum panel size
  - [x] Ensure slider container doesn't obscure textarea content

- [x] **Task 8: Add visual resize handles/cursors** (AC: 1)
  - [x] Use interact.js default handles
  - [x] interact.js automatically applies proper cursors
  - [x] Add CSS for resize edges
  - [x] Test resize handles are visible and clickable at panel boundaries

## Dev Notes

### Panel State Schema
[Source: architecture/coding-standards.md#Code Structure, Epic 2 Technical Notes]

Panel state schema includes size property:
```javascript
{
  id: string,
  title: string,
  code: string,
  playing: boolean,
  position: { x: number, y: number },  // Story 2.3
  size: { w: number, h: number },      // This story
  zIndex: number                       // Story 2.4
}
```

Default size: `{ w: 400, h: 300 }` (configurable constant).

### interact.js Integration
[Source: Epic 2 Technical Notes]

Library: https://interactjs.io/

Installation:
```bash
npm install interactjs
```

Basic resize setup:
```javascript
import interact from 'interactjs';

function initializeResizable(panelElement) {
  interact(panelElement)
    .resizable({
      edges: { left: true, right: true, bottom: true, top: true },
      listeners: {
        move(event) {
          const { width, height } = event.rect;
          const target = event.target;

          // Update element size
          target.style.width = `${width}px`;
          target.style.height = `${height}px`;

          // Update panel state
          const panelId = target.id;
          updatePanelSize(panelId, { w: width, h: height });
        }
      },
      modifiers: [
        interact.modifiers.restrictSize({
          min: { width: 300, height: 200 }
        })
      ]
    });
}
```

### CSS Refactor: Absolute Positioning
[Source: Epic 2 Technical Notes, architecture/source-tree.md]

Current CSS (grid layout in `index.html` lines 8-169):
```css
/* OLD: Fixed grid layout */
body {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}
```

New CSS (absolute positioning):
```css
/* NEW: Absolute positioning for free movement */
.card {
  position: absolute;
  width: 400px;
  height: 300px;
  min-width: 300px;
  min-height: 200px;
  border: 2px solid #333;
  border-radius: 8px;
  background: #1a1a1a;
  overflow: hidden; /* Prevent content overflow */
}

/* Default positions (staggered) */
#card-1 { left: 20px; top: 100px; }
#card-2 { left: 440px; top: 100px; }
#card-3 { left: 20px; top: 420px; }
#card-4 { left: 440px; top: 420px; }
```

### Minimum Size Constraints
[Source: Epic 2 Acceptance Criteria]

Minimum dimensions:
- **Width:** 300px (enough for code + sliders)
- **Height:** 200px (header + textarea + minimal slider space)

Enforce via interact.js modifiers (see code example above).

### Textarea Flexbox Layout
[Source: architecture/source-tree.md#Entry Point]

Current panel structure:
```html
<div class="card">
  <div class="card-header">
    <h3>Title</h3>
    <button>Play</button>
  </div>
  <textarea class="code-input"></textarea>
  <div class="slider-container"></div>
</div>
```

Apply flexbox to make textarea fill available space:
```css
.card {
  display: flex;
  flex-direction: column;
}

.card-header {
  flex-shrink: 0; /* Fixed height */
  height: 50px;
}

.code-input {
  flex-grow: 1; /* Fill remaining space */
  resize: none; /* Disable manual textarea resize */
  overflow-y: auto;
}

.slider-container {
  flex-shrink: 0; /* Fixed or auto height */
  max-height: 150px;
  overflow-y: auto;
}
```

### Slider Container Scrolling
[Source: architecture/source-tree.md#Application Logic]

If many sliders are present, slider container should scroll:
```css
.slider-container {
  max-height: 150px; /* Prevent excessive height */
  overflow-y: auto;
  padding: 10px;
}
```

Test case: Pattern with 10+ sliders should render scrollable container.

### Resize Event Performance
[Source: architecture/coding-standards.md#Performance]

Resize events fire rapidly. Consider debouncing state updates:
```javascript
let resizeTimeout;
function updatePanelSize(panelId, size) {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    panels[panelId].size = size;
    // Save to localStorage if Epic 4 enabled
  }, 100); // Debounce 100ms
}
```

Alternative: Update state immediately (lightweight operation), debounce localStorage save only.

### Viewport Boundary Constraints
[Source: Epic 2 Technical Notes]

Out of scope for this story (handled in Story 2.3), but consider:
- Resize should not push panel beyond viewport edges
- interact.js `restrictEdges` modifier can enforce boundaries

### File Locations
[Source: architecture/source-tree.md#Future Modular Architecture]

Files to create:
- **Create:** `src/ui/dragResize.js` - Wrapper for interact.js initialization

Files to modify:
- **Modify:** `package.json` - Add interactjs dependency
- **Modify:** `src/managers/panelManager.js` - Add `updatePanelSize()` function
- **Modify:** `src/ui/panelRenderer.js` - Call `initializeResizable()` after panel creation
- **Modify:** `index.html` - Update CSS for absolute positioning and flexbox layout

### Alternative Libraries
[Source: Epic 2 Technical Notes]

Other options if interact.js is too heavy:
- **re-resizable** (React-only, not compatible)
- **plain-resizable** (vanilla JS, lightweight)
- **Custom implementation** (mouse events, more code but full control)

Recommendation: **interact.js** (handles both drag and resize for Stories 2.2 and 2.3).

## Testing

Manual testing checklist:

- [x] Panel edges show resize cursor on hover
- [x] Dragging right edge increases width
- [x] Dragging bottom edge increases height
- [x] Dragging corner resizes both width and height
- [x] Panel cannot be resized below 300x200px
- [x] Textarea grows/shrinks with panel height
- [x] Slider container remains visible during resize
- [x] Slider controls remain functional at minimum size
- [x] Panel size is saved in panel state object
- [x] Resizing one panel does not affect other panels
- [x] Resize works for both statically created and dynamically created panels

**Testing Status:** ✅ All manual tests passed. Verified by user in live testing session.

## Change Log

| Date       | Version | Description          | Author |
|------------|---------|----------------------|--------|
| 2025-11-16 | 1.0     | Initial story draft  | Claude |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Implementation Summary

All tasks completed successfully. Panels are now resizable with drag and resize functionality using interact.js library.

**Key Changes:**
1. Installed `interactjs` package via npm
2. Created `src/ui/dragResize.js` wrapper module for interact.js integration
3. Updated CSS:
   - `.container` changed to `position: relative` for absolute positioning context
   - `.card` changed to `position: absolute` with flexbox internal layout
   - `.code-input` uses `flex-grow: 1` to fill available space
   - `.slider-container` added with `max-height: 150px` and scroll
   - Removed media query that changed container layout
4. Updated `renderPanel()` to:
   - Set initial size and position from panel state
   - Add slider-container element to panel HTML
   - Store position in dataset for interact.js
5. Updated `renderSliders()` to use `#sliders-{panelId}` container
6. Added staggered positioning for new panels (50px offset)
7. Call `initializeDragAndResize()` after creating each panel

**Implementation Notes:**
- Panel state schema already included size and position from Story 1.1
- interact.js handles both resize and drag with single library
- Minimum size enforced: 300px width, 200px height
- Resize updates both DOM and panel state simultaneously
- Transform-based positioning for smooth drag/resize
- Flexbox layout ensures textarea grows/shrinks with panel

### Debug Log References
None - straightforward implementation, no issues encountered.

### Completion Notes

Implementation follows story requirements and coding standards. All acceptance criteria met:
- [x] AC1: Panel edges have visible resize handles (interact.js provides cursors)
- [x] AC2: Dragging edge/corner resizes panel width and/or height
- [x] AC3: Panel maintains minimum size (300x200px)
- [x] AC4: Textarea grows/shrinks with panel size (flex-grow: 1)
- [x] AC5: Sliders remain visible and functional (max-height with scroll)
- [x] AC6: Panel size saved in panel state

**Layout:** Panels now use absolute positioning, enabling free movement and overlap.
**Responsiveness:** Textarea and sliders adapt to panel size changes.
**UX:** Smooth resize with minimum size constraints prevents unusability.

### File List

Created:
- `src/ui/dragResize.js` - interact.js wrapper module for drag and resize

Modified:
- `package.json` - Added interactjs dependency
- `package-lock.json` - Locked interactjs version
- `src/main.js` - Import dragResize, call initializeDragAndResize(), update renderSliders()
- `src/managers/panelManager.js` - Updated renderPanel() with size/position and slider-container
- `index.html` - Updated CSS for absolute positioning, flexbox layout, slider-container styles
- `docs/stories/2.2.resizable-panels.md` - This file (Dev Agent Record, task checkboxes, status)

## QA Results

_Results from QA Agent review of the completed story implementation_
