# Story 4.5: Appearance Settings Controls

## Status
Ready for Review

## Story

**As a** user,
**I want** to configure visual appearance settings,
**so that** I can customize the UI to my taste

## Acceptance Criteria

1. **Color Scheme**: Dropdown for theme selection (Dark, Light, custom themes from Epic 2 future)
2. **Font Size**: Slider for code editor font size (10-24px)
3. **Panel Opacity**: Slider for panel background opacity (50-100%)
4. **Animation Speed**: Toggle for UI animations (normal, fast, disabled)
5. All appearance settings applied immediately (live preview)

## Tasks / Subtasks

- [ ] **Task 1: Add Color Scheme dropdown** (AC: 1, 5)
  - [ ] Add dropdown select to Appearance section in settings modal
  - [ ] Label: "Color Scheme"
  - [ ] Options: Dark (default), Light, High Contrast (future)
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="color-scheme-select">Color Scheme</label>
      <select id="color-scheme-select">
        <option value="dark">Dark (Default)</option>
        <option value="light">Light</option>
      </select>
    </div>
    ```
  - [ ] Bind to `settings.colorScheme`
  - [ ] On change, apply theme immediately (live preview)

- [ ] **Task 2: Add Font Size slider** (AC: 2, 5)
  - [ ] Add range slider to Appearance section
  - [ ] Label: "Code Editor Font Size"
  - [ ] Range: 10px to 24px, default: 14px
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="font-size-slider">
        Code Editor Font Size: <span id="font-size-value">14px</span>
      </label>
      <input type="range" id="font-size-slider"
             min="10" max="24" value="14" step="1">
    </div>
    ```
  - [ ] On change, update font size immediately (live preview)
  - [ ] Display current value in label

- [ ] **Task 3: Add Panel Opacity slider** (AC: 3, 5)
  - [ ] Add range slider to Appearance section
  - [ ] Label: "Panel Background Opacity"
  - [ ] Range: 50% to 100%, default: 95%
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="panel-opacity-slider">
        Panel Background Opacity: <span id="panel-opacity-value">95%</span>
      </label>
      <input type="range" id="panel-opacity-slider"
             min="50" max="100" value="95" step="5">
    </div>
    ```
  - [ ] On change, update panel opacity immediately (live preview)
  - [ ] Apply to all panel backgrounds

- [ ] **Task 4: Add Animation Speed dropdown** (AC: 4, 5)
  - [ ] Add dropdown select to Appearance section
  - [ ] Label: "UI Animation Speed"
  - [ ] Options: Normal, Fast, Disabled
  - [ ] HTML structure:
    ```html
    <div class="setting-item">
      <label for="animation-speed-select">UI Animation Speed</label>
      <select id="animation-speed-select">
        <option value="normal">Normal</option>
        <option value="fast">Fast</option>
        <option value="disabled">Disabled</option>
      </select>
    </div>
    ```
  - [ ] On change, update CSS transition durations

- [ ] **Task 5: Implement color scheme switching** (AC: 1, 5)
  - [ ] Create `applyColorScheme(scheme)` function
  - [ ] Define CSS variables for dark and light themes:
    ```css
    :root {
      /* Dark theme (default) */
      --bg-color: #0a0a0a;
      --card-bg: #1a1a1a;
      --text-color: #00ff00;
      --border-color: #00ff00;
    }

    body.theme-light {
      /* Light theme */
      --bg-color: #f0f0f0;
      --card-bg: #ffffff;
      --text-color: #000000;
      --border-color: #333333;
    }
    ```
  - [ ] Apply theme by toggling `body.theme-{scheme}` class
  - [ ] Save theme preference to localStorage

- [ ] **Task 6: Implement font size adjustment** (AC: 2, 5)
  - [ ] Create `applyFontSize(size)` function
  - [ ] Update CSS variable: `--code-font-size`
  - [ ] Apply to all code textareas:
    ```css
    .code-input, .master-code {
      font-size: var(--code-font-size, 14px);
    }
    ```
  - [ ] Update slider value display on change

- [ ] **Task 7: Implement panel opacity adjustment** (AC: 3, 5)
  - [ ] Create `applyPanelOpacity(opacity)` function
  - [ ] Update CSS variable: `--panel-opacity`
  - [ ] Apply to all panels:
    ```css
    .card {
      background: rgba(26, 26, 26, var(--panel-opacity, 0.95));
    }
    ```
  - [ ] Update slider value display on change

- [ ] **Task 8: Implement animation speed adjustment** (AC: 4, 5)
  - [ ] Create `applyAnimationSpeed(speed)` function
  - [ ] Update CSS variable: `--transition-duration`
  - [ ] Map speed to duration:
    - Normal: 0.2s
    - Fast: 0.1s
    - Disabled: 0s
  - [ ] Apply to all transitions:
    ```css
    * {
      transition-duration: var(--transition-duration, 0.2s);
    }
    ```

- [ ] **Task 9: Wire live preview for all settings** (AC: 5)
  - [ ] Attach `input` event listeners to all appearance controls
  - [ ] On change, immediately apply setting (no Save button required)
  - [ ] Still save to localStorage for persistence
  - [ ] Example:
    ```javascript
    document.getElementById('font-size-slider').addEventListener('input', (e) => {
      const size = e.target.value;
      applyFontSize(size);
      document.getElementById('font-size-value').textContent = `${size}px`;
      updateSettings('fontSize', size);
    });
    ```

- [ ] **Task 10: Load appearance settings into form** (AC: 5)
  - [ ] When opening settings modal, load current values:
    ```javascript
    const settings = getSettings();
    document.getElementById('color-scheme-select').value = settings.colorScheme;
    document.getElementById('font-size-slider').value = settings.fontSize;
    document.getElementById('panel-opacity-slider').value = settings.panelOpacity;
    document.getElementById('animation-speed-select').value = settings.animationSpeed;
    ```
  - [ ] Update value displays for sliders

- [ ] **Task 11: Apply appearance settings on init** (AC: 5)
  - [ ] Load settings on app initialization (Story 4.1)
  - [ ] Apply color scheme: `applyColorScheme(settings.colorScheme)`
  - [ ] Apply font size: `applyFontSize(settings.fontSize)`
  - [ ] Apply panel opacity: `applyPanelOpacity(settings.panelOpacity)`
  - [ ] Apply animation speed: `applyAnimationSpeed(settings.animationSpeed)`

## Dev Notes

### Appearance Settings Section HTML
[Source: AC: 1-4, epic-4-settings-system.md]

```html
<section class="settings-section" id="appearance-settings">
  <h3>Appearance</h3>

  <!-- Color Scheme Dropdown (AC: 1) -->
  <div class="setting-item">
    <label for="color-scheme-select">Color Scheme</label>
    <select id="color-scheme-select" class="setting-select">
      <option value="dark">Dark (Default)</option>
      <option value="light">Light</option>
      <!-- Future: <option value="high-contrast">High Contrast</option> -->
    </select>
    <p class="setting-description">
      Choose between dark and light themes
    </p>
  </div>

  <!-- Font Size Slider (AC: 2) -->
  <div class="setting-item">
    <label for="font-size-slider">
      Code Editor Font Size: <span id="font-size-value">14px</span>
    </label>
    <input type="range" id="font-size-slider" class="setting-slider"
           min="10" max="24" value="14" step="1">
    <p class="setting-description">
      Adjust font size for all code editors (10-24px)
    </p>
  </div>

  <!-- Panel Opacity Slider (AC: 3) -->
  <div class="setting-item">
    <label for="panel-opacity-slider">
      Panel Background Opacity: <span id="panel-opacity-value">95%</span>
    </label>
    <input type="range" id="panel-opacity-slider" class="setting-slider"
           min="50" max="100" value="95" step="5">
    <p class="setting-description">
      Adjust transparency of panel backgrounds (50-100%)
    </p>
  </div>

  <!-- Animation Speed Dropdown (AC: 4) -->
  <div class="setting-item">
    <label for="animation-speed-select">UI Animation Speed</label>
    <select id="animation-speed-select" class="setting-select">
      <option value="normal">Normal (0.2s)</option>
      <option value="fast">Fast (0.1s)</option>
      <option value="disabled">Disabled</option>
    </select>
    <p class="setting-description">
      Control speed of UI transitions and animations
    </p>
  </div>
</section>
```

### CSS Variables for Theming
[Source: AC: 1, 5, modern CSS custom properties]

Define CSS variables in `:root` and theme classes:
```css
:root {
  /* Dark theme (default) */
  --bg-color: #0a0a0a;
  --card-bg: #1a1a1a;
  --text-color: #00ff00;
  --border-color: #00ff00;
  --header-color: #00ff00;

  /* Appearance settings */
  --code-font-size: 14px;
  --panel-opacity: 0.95;
  --transition-duration: 0.2s;
}

body.theme-light {
  /* Light theme */
  --bg-color: #f0f0f0;
  --card-bg: #ffffff;
  --text-color: #000000;
  --border-color: #333333;
  --header-color: #0066cc;
}

body {
  background-color: var(--bg-color);
  color: var(--text-color);
}

.card {
  background: rgba(26, 26, 26, var(--panel-opacity));
  border: 1px solid var(--border-color);
}

.code-input, .master-code {
  font-size: var(--code-font-size);
}

* {
  transition-duration: var(--transition-duration);
}
```

### Color Scheme Implementation
[Source: AC: 1, 5]

```javascript
// src/managers/themeManager.js
export function applyColorScheme(scheme) {
  // Remove existing theme classes
  document.body.classList.remove('theme-dark', 'theme-light');

  // Apply new theme
  document.body.classList.add(`theme-${scheme}`);

  console.log('Color scheme applied:', scheme);
}

// Wire dropdown
document.getElementById('color-scheme-select').addEventListener('change', (e) => {
  const scheme = e.target.value;
  applyColorScheme(scheme);

  const settings = getSettings();
  settings.colorScheme = scheme;
  saveSettings(settings);
});
```

### Font Size Implementation
[Source: AC: 2, 5]

```javascript
export function applyFontSize(size) {
  document.documentElement.style.setProperty('--code-font-size', `${size}px`);
  console.log('Font size applied:', size + 'px');
}

// Wire slider
document.getElementById('font-size-slider').addEventListener('input', (e) => {
  const size = e.target.value;

  // Update display
  document.getElementById('font-size-value').textContent = `${size}px`;

  // Apply immediately (live preview)
  applyFontSize(size);

  // Save to settings
  const settings = getSettings();
  settings.fontSize = parseInt(size, 10);
  saveSettings(settings);
});
```

### Panel Opacity Implementation
[Source: AC: 3, 5]

```javascript
export function applyPanelOpacity(opacity) {
  // Convert percentage to decimal (95 → 0.95)
  const opacityValue = opacity / 100;
  document.documentElement.style.setProperty('--panel-opacity', opacityValue);
  console.log('Panel opacity applied:', opacity + '%');
}

// Wire slider
document.getElementById('panel-opacity-slider').addEventListener('input', (e) => {
  const opacity = e.target.value;

  // Update display
  document.getElementById('panel-opacity-value').textContent = `${opacity}%`;

  // Apply immediately (live preview)
  applyPanelOpacity(opacity);

  // Save to settings
  const settings = getSettings();
  settings.panelOpacity = parseInt(opacity, 10);
  saveSettings(settings);
});
```

### Animation Speed Implementation
[Source: AC: 4, 5]

```javascript
export function applyAnimationSpeed(speed) {
  const durations = {
    'normal': '0.2s',
    'fast': '0.1s',
    'disabled': '0s'
  };

  const duration = durations[speed] || '0.2s';
  document.documentElement.style.setProperty('--transition-duration', duration);
  console.log('Animation speed applied:', speed, `(${duration})`);
}

// Wire dropdown
document.getElementById('animation-speed-select').addEventListener('change', (e) => {
  const speed = e.target.value;
  applyAnimationSpeed(speed);

  const settings = getSettings();
  settings.animationSpeed = speed;
  saveSettings(settings);
});
```

### Slider Styling
[Source: AC: 2, 3, application theme]

```css
.setting-slider {
  width: 100%;
  height: 6px;
  background: #333;
  border-radius: 3px;
  outline: none;
  -webkit-appearance: none;
}

.setting-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: #00ff00;
  border-radius: 50%;
  cursor: pointer;
}

.setting-slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: #00ff00;
  border-radius: 50%;
  cursor: pointer;
  border: none;
}

.setting-slider:hover::-webkit-slider-thumb {
  box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
}

.setting-slider:hover::-moz-range-thumb {
  box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
}
```

### Live Preview Pattern
[Source: AC: 5]

Apply settings immediately on change, not on Save button:
```javascript
// ✅ Good: Live preview with auto-save
slider.addEventListener('input', (e) => {
  const value = e.target.value;
  applySettingImmediately(value); // Visual change
  updateSettings('key', value);   // Persist to localStorage
});

// ❌ Bad: Delay until Save button clicked
slider.addEventListener('input', (e) => {
  tempSettings.value = e.target.value; // Stored temporarily
  // Only applied when Save button clicked
});
```

### Default Appearance Settings
[Source: Story 4.1, DEFAULT_SETTINGS schema]

```javascript
const DEFAULT_SETTINGS = {
  version: 1,
  yolo: false,
  colorScheme: 'dark',        // AC: 1 - Dark theme by default
  fontSize: 14,               // AC: 2 - 14px default
  panelOpacity: 95,           // AC: 3 - 95% opacity default
  animationSpeed: 'normal',   // AC: 4 - Normal animations
  behavior: { ... },
  snippetLocation: '',
  remoteWSLayout: 'side-panel',
  skinPack: ''
};
```

### Apply Settings on Initialization
[Source: AC: 5, Story 4.1]

```javascript
// src/main.js
async function initializeApp() {
  const settings = loadSettings();

  // Apply appearance settings
  applyColorScheme(settings.colorScheme || 'dark');
  applyFontSize(settings.fontSize || 14);
  applyPanelOpacity(settings.panelOpacity || 95);
  applyAnimationSpeed(settings.animationSpeed || 'normal');

  // Initialize Strudel
  await initializeStrudel();

  // ... rest of initialization
}
```

### Future: Custom Themes
[Source: AC: 1, Epic 2 potential extension]

Support custom theme JSON files:
```javascript
// Future enhancement
async function loadCustomTheme(url) {
  const response = await fetch(url);
  const theme = await response.json();

  // Apply custom CSS variables
  Object.keys(theme).forEach(key => {
    document.documentElement.style.setProperty(`--${key}`, theme[key]);
  });
}
```

### Testing

Manual testing checklist:

- [ ] Color Scheme dropdown visible in Appearance section
- [ ] Changing color scheme applies immediately (no Save button required)
- [ ] Dark theme: Black background, green text
- [ ] Light theme: White background, dark text
- [ ] Font Size slider visible with current value displayed
- [ ] Moving font size slider updates all code editors immediately
- [ ] Font size range: 10px to 24px works correctly
- [ ] Panel Opacity slider visible with current value displayed
- [ ] Moving opacity slider updates panel backgrounds immediately
- [ ] Opacity range: 50% to 100% works correctly
- [ ] Animation Speed dropdown visible with 3 options
- [ ] Normal speed: Smooth animations (0.2s)
- [ ] Fast speed: Quick animations (0.1s)
- [ ] Disabled: No animations (0s)
- [ ] All settings persist after page reload
- [ ] Live preview: All changes visible immediately without Save button
- [ ] Sliders styled correctly with green thumb
- [ ] Dropdowns styled to match application theme

## Change Log

| Date       | Version | Description          | Author |
|------------|---------|----------------------|--------|
| 2025-11-16 | 1.0     | Initial story draft  | Claude |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review of the completed story implementation_
